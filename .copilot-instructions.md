# üéØ ONE SHOT ‚Äî NewGen Studio: Multi-Mode AI Instruction System

**Version**: 2.0 (Combined Multi-Mode)  
**Date**: December 10, 2025  
**Mode**: Auto-detects context or responds to explicit mode commands

---

## üîÄ Mode Selector

This ONE SHOT operates in **4 modes**. The AI auto-detects based on your request, or you can explicitly trigger a mode:

| Command | Mode | Use For |
|---------|------|---------|
| **(auto)** | **Repo Mode** | General coding, PRs, commits, file operations |
| `@ui` or `@design` | **UI/UX Mode** | Components, styling, animations, Base44-level polish |
| `@backend` or `@api` | **Backend Mode** | Express routes, services, domain models |
| `@domain` or `@pharma` | **Domain Mode** | Biologics workflows, compliance, scientific logic |

---

# üèõÔ∏è MODE 1: Repository & Code Operations (Default)

## 1. Repository & Branching Rules
- Use the existing repo: **NewGenAPPs/NewGen-Studio**
- Default working branch: **feat/instrument-adapter-sdk**
- After pushing commits: **open a Pull Request automatically**

### Commit message to always use:
```
chore(adapter): add Instrument Adapter SDK scaffold, OPC-UA simulator, and CI smoke tests
```

### PR Title:
```
Instrument Adapter SDK Scaffolding + OPC-UA Simulator + CI
```

### PR Body:
```
This PR introduces the Instrument Adapter SDK scaffold, OPC-UA simulator, initial CI smoke tests, and developer run instructions.  
Includes safety notes, backend launch steps, and integration points for biologics/pharma workflows.
```

---

## 2. Platform Context (High-Level)
NewGen Studio is an **AI-native biopharma application builder**, positioned as a higher-compliance, domain-aware alternative to Base44, Retool, or Appsmith.

The system has three major layers:

### Frontend
- React + Tailwind Studio UI  
- AI Builder (chat-to-app generator)  
- Dashboard, Templates, Projects, Support Desk  
- Goal: **premium-level polish** comparable to Base44+

### Backend
- Node + Express  
- Endpoints for: projects, templates, tickets, AI generation, biologics & pharma domain models  
- Produces standardized JSON responses:
```json
{
  "status": "ok",
  "data": { ... },
  "messages": [ ... ]
}
```

### Domain Layer
- Biologics workflows (assays, batches, studies)  
- FDA-conscious architecture (audit, traceability, segregation of environments)

---

## 3. UI/UX Expectations (Match or Surpass Base44)
When generating UI code:
- Use Tailwind + Radix/ShadCN patterns  
- High-fidelity components  
- Smooth transitions, micro-interactions  
- Consistent spacing, radius tokens, shadows  
- Multi-pane layouts and resizable editors  
- Professional-grade dashboard visuals  

The design goal is **modern, elegant, and operationally efficient** ‚Äî feel like Base44 or beyond.

---

## 4. Backend Expectations
When generating backend code:
- Use Express with clean route ‚Üí service ‚Üí response structure  
- Prefer async/await + try/catch  
- Include comments for FDA/GxP considerations  
- Avoid overly complex abstractions  
- Provide clean REST endpoints and predictable JSON  

---

## 5. Collaboration & Integration Rules
When asked to create or modify code:
1. Apply all changes to `feat/instrument-adapter-sdk`
2. Use the required commit message
3. Push the commit
4. Open a PR with the defined PR template
5. Summarize changes clearly

When adding new functionality:
- Provide file scaffolds  
- Add usage notes in code comments  
- Include example requests/responses for Express endpoints  
- Ensure frontend integration hooks (React query, fetch wrappers, API client)

When asked to integrate with external systems (e.g., Base44):
- Produce a schema adapter  
- Create import/export utilities  
- Document assumptions  

---

## 6. Safety & Compliance Notes for PRs
Every PR must contain:
- Run instructions for backend and frontend  
- Explanation of new endpoints  
- Safety notes related to regulated data flows  
- Any assumptions about API stability  
- Domain-level clarifications if biologics/pharma models are modified  

---

## 7. Clarification Rules
Only ask clarifying questions when:
- Repo name is missing  
- Branch name is missing  
- File path reference is ambiguous  

Otherwise: **act immediately based on this one-shot.**

---

## 8. Behavior Expectations
- Be decisive and action-oriented  
- Do not offer philosophical alternatives  
- Produce best-practice, production-quality code  
- Maintain consistent coding style across files  
- Keep changes minimal unless asked for refactor  

---

## 9. Technical Stack Reference

### Frontend
- **Framework**: React 19 + Vite 7
- **Styling**: TailwindCSS + custom design system
- **Components**: Radix UI + ShadCN (target)
- **Icons**: Lucide React
- **Routing**: React Router DOM v7
- **State**: Local state + React hooks
- **API Client**: Fetch wrapper in `src/api/client.js`

### Backend
- **Runtime**: Node.js 20 LTS
- **Framework**: Express 4.x
- **Port**: 4000 (development), configurable via PORT env var
- **Database**: Future: PostgreSQL + TimescaleDB
- **Auth**: Future: OAuth 2.0 + RBAC

### Domain Layer
- **Compliance**: FDA 21 CFR Part 11 architecture
- **Instrument Protocol**: OPC-UA (node-opcua)
- **AI Orchestration**: Multi-agent system (Planner, Simulator, Safety, Executor)

---

## 10. File Structure Quick Reference

```
newgen-studio/
‚îú‚îÄ‚îÄ src/                          # Frontend React app
‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ client.js            # API wrapper (fetch)
‚îÇ   ‚îú‚îÄ‚îÄ components/              # Reusable UI components
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ BackendStatusCard.jsx
‚îÇ   ‚îú‚îÄ‚îÄ layout/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AppShell.jsx         # Main app layout
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Sidebar.jsx          # Navigation
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ TopBar.jsx           # Header
‚îÇ   ‚îú‚îÄ‚îÄ pages/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Dashboard.jsx        # Dashboard home
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ BuildNewApp.jsx      # AI Builder
‚îÇ   ‚îú‚îÄ‚îÄ App.jsx                  # Root component
‚îÇ   ‚îî‚îÄ‚îÄ main.jsx                 # Entry point
‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îú‚îÄ‚îÄ server.js                # Express server entry
‚îÇ   ‚îú‚îÄ‚îÄ app.js                   # Express app configuration
‚îÇ   ‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.js             # Route aggregator
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ biologics.routes.js  # Pharma domain endpoints
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ projects.routes.js   # Project CRUD
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ templates.routes.js  # Template library
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ agents.routes.js     # AI orchestration
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ simulations.routes.js # Digital twins
‚îÇ   ‚îú‚îÄ‚îÄ services/                # Business logic
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ orchestrator.service.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ simulation.service.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ template.service.js
‚îÇ   ‚îî‚îÄ‚îÄ middleware/              # Express middleware
‚îÇ       ‚îú‚îÄ‚îÄ errorHandler.js
‚îÇ       ‚îî‚îÄ‚îÄ notFound.js
‚îú‚îÄ‚îÄ instrument-adapter-sdk/      # OPC-UA adapter
‚îÇ   ‚îú‚îÄ‚îÄ adapter-sdk/             # Client library
‚îÇ   ‚îî‚îÄ‚îÄ simulator/               # OPC-UA test server
‚îî‚îÄ‚îÄ .copilot-instructions.md     # This file
```

---

## 11. Common Commands

### Start Frontend (Vite Dev Server)
```bash
npm run dev
# Runs on http://localhost:5175
```

### Start Backend (Express API)
```bash
cd backend
node server.js
# Runs on http://localhost:4000
```

### Backend with Auto-Reload (Recommended)
```bash
cd backend
npx nodemon server.js
```

### Run Tests
```bash
npm test
```

### Lint Code
```bash
npm run lint
```

---

## 12. API Base URLs

- **Development Frontend**: `http://localhost:5175`
- **Development Backend**: `http://localhost:4000`
- **API Prefix**: `/api` (all routes start with this)
- **API Version**: `/api/v1` (versioned endpoints)

### Key Endpoints
- `GET /api/health` - Health check
- `GET /api/v1/biologics/summary` - Biologics pipeline summary
- `GET /api/v1/biologics/pipelines` - Detailed pipeline data
- `GET /api/v1/biologics/compliance` - Compliance dashboard
- `GET /api/v1/biologics/instruments` - Connected instruments
- `GET /api/v1/projects` - Project list
- `GET /api/v1/templates` - Template library
- `POST /api/v1/agents/orchestrate` - AI agent orchestration
- `POST /api/generate` - AI code generation

---

## 13. Environment Variables

### Backend (.env)
```
PORT=4000
NODE_ENV=development
FRONTEND_ORIGIN=http://localhost:5175
LOG_LEVEL=info
```

### Frontend (.env)
```
VITE_API_BASE=http://localhost:4000
```

---

## 14. Compliance & Safety Guardrails

### Always Include in Code Comments:
- **FDA Consideration**: Any data capture/transformation that affects batch records
- **Audit Trail**: Any user action that requires traceability
- **Safety Check**: Any AI-generated recommendation that affects production
- **Operator Approval**: Any command execution that requires human-in-the-loop

### Example:
```javascript
// FDA 21 CFR Part 11 Consideration:
// This endpoint generates batch production records (BPR).
// All data must be immutable, timestamped, and include operator e-signature.
router.post('/api/v1/batches/release', async (req, res) => {
  // Implementation with audit trail...
});
```

---

# End of ONE SHOT

---

# üé® MODE 2: UI/UX Modernization (Base44-Level Polish)

**Trigger**: Use `@ui`, `@design`, or when working on components/styling

## Design Philosophy

NewGen Studio aims to **match or surpass Base44** in visual quality while maintaining biopharma domain focus.

### Core Principles
- **Premium component fidelity** (Radix UI + ShadCN quality)
- **Smooth micro-interactions** (200ms transitions, spring easing)
- **Professional elevation system** (4-8 shadow levels)
- **Consistent spacing tokens** (4px base grid)
- **Domain-specific visualization** (scientific charts, protocol diagrams)

---

## Component Standards

### Typography
```css
/* Heading Scale */
h1: text-3xl font-bold (30px)
h2: text-2xl font-semibold (24px)
h3: text-xl font-semibold (20px)
h4: text-lg font-medium (18px)
body: text-sm (14px)
caption: text-xs (12px)
```

### Color Palette
```javascript
Primary: slate-800 (text), blue-600 (actions)
Secondary: slate-600 (meta text)
Success: emerald-500
Warning: amber-500
Danger: red-500
Neutral: slate-100 (backgrounds), slate-200 (borders)
```

### Spacing Scale
```
xs: 0.5rem (8px)
sm: 0.75rem (12px)
md: 1rem (16px)
lg: 1.5rem (24px)
xl: 2rem (32px)
2xl: 3rem (48px)
```

### Border Radius
```
sm: 0.25rem (4px) - buttons, badges
md: 0.5rem (8px) - cards, inputs
lg: 0.75rem (12px) - modals, major sections
```

### Shadows (Elevation)
```css
Level 1: shadow-sm (0 1px 2px rgba(0,0,0,0.05))
Level 2: shadow (0 1px 3px rgba(0,0,0,0.1))
Level 3: shadow-md (0 4px 6px rgba(0,0,0,0.1))
Level 4: shadow-lg (0 10px 15px rgba(0,0,0,0.1))
```

---

## Animation Standards

### Transitions
```css
/* Micro-interactions (buttons, hover) */
transition: all 150ms ease-out;

/* Cards, panels */
transition: all 200ms ease-out;

/* Modals, drawers */
transition: all 300ms cubic-bezier(0.4, 0, 0.2, 1);

/* AI typing animation */
transition: all 500ms ease-in-out;
```

### Hover States
```jsx
// Button hover
className="hover:scale-105 hover:shadow-md transition-all"

// Card hover
className="hover:border-slate-300 hover:shadow-lg transition-all"

// Icon hover
className="hover:text-blue-600 transition-colors"
```

---

## Component Patterns

### Card Component
```jsx
<div className="bg-white border border-slate-200 rounded-lg p-4 hover:border-slate-300 hover:shadow-md transition-all">
  <div className="flex items-center justify-between mb-3">
    <h3 className="text-lg font-semibold text-slate-800">Title</h3>
    <span className="text-xs text-slate-500">Meta</span>
  </div>
  <p className="text-sm text-slate-600">Content</p>
</div>
```

### Button Variants
```jsx
// Primary
className="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors"

// Secondary
className="px-4 py-2 bg-slate-100 text-slate-700 rounded-md hover:bg-slate-200 transition-colors"

// Ghost
className="px-4 py-2 text-slate-700 hover:bg-slate-100 rounded-md transition-colors"
```

### Badge Variants
```jsx
// Success
className="px-2 py-1 text-xs font-semibold bg-emerald-100 text-emerald-700 rounded"

// Warning
className="px-2 py-1 text-xs font-semibold bg-amber-100 text-amber-700 rounded"

// Neutral
className="px-2 py-1 text-xs font-semibold bg-slate-100 text-slate-700 rounded"
```

---

## Domain-Specific Components

### Biologics Pipeline Card
```jsx
<div className="bg-white border border-slate-200 rounded-lg p-4">
  <div className="flex items-center gap-3 mb-3">
    <div className="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center">
      <Icon className="w-5 h-5 text-blue-600" />
    </div>
    <div className="flex-1">
      <h4 className="font-semibold text-slate-800">Pipeline Name</h4>
      <p className="text-xs text-slate-500">Stage ‚Ä¢ Operator</p>
    </div>
    <span className="px-2 py-1 text-xs font-semibold bg-emerald-100 text-emerald-700 rounded">
      Low Risk
    </span>
  </div>
  <div className="w-full bg-slate-100 rounded-full h-2">
    <div className="bg-blue-600 h-2 rounded-full" style={{width: '75%'}}></div>
  </div>
</div>
```

### Status Indicator
```jsx
<div className="flex items-center gap-2">
  <div className="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></div>
  <span className="text-sm font-medium text-slate-700">Connected</span>
</div>
```

---

## Layout Patterns

### Dashboard Grid
```jsx
<div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
  <div className="lg:col-span-2">{/* Main content */}</div>
  <div>{/* Sidebar */}</div>
</div>
```

### Multi-Pane Editor
```jsx
<div className="flex h-screen">
  <div className="w-64 border-r border-slate-200">{/* Sidebar */}</div>
  <div className="flex-1 flex flex-col">
    <div className="flex-1 overflow-auto">{/* Editor */}</div>
    <div className="h-80 border-t border-slate-200">{/* Preview */}</div>
  </div>
</div>
```

---

## Best Practices

### DO ‚úÖ
- Use consistent spacing (4px base grid)
- Add hover states to all interactive elements
- Use semantic color names (success, warning, danger)
- Provide visual feedback for actions (loading states, success/error)
- Support keyboard navigation (focus states, tab order)
- Include ARIA labels for accessibility

### DON'T ‚ùå
- Mix spacing scales arbitrarily
- Skip hover/focus states
- Use absolute colors (use CSS variables/Tailwind tokens)
- Forget loading states
- Ignore responsive breakpoints
- Skip accessibility attributes

---

# üîß MODE 3: Backend/API Development

**Trigger**: Use `@backend`, `@api`, or when working on Express routes/services

## Architecture Pattern

```
routes/ ‚Üí controllers/ ‚Üí services/ ‚Üí models/
```

### Route Template
```javascript
// backend/routes/[domain].routes.js
import express from 'express';
import controller from '../controllers/[domain].controller.js';

const router = express.Router();

/**
 * GET /api/v1/[domain]/[resource]
 * [Description]
 */
router.get('/[resource]', controller.getResource);

/**
 * POST /api/v1/[domain]/[resource]
 * [Description]
 * 
 * FDA Consideration: [If applicable]
 * Audit Trail: [If applicable]
 */
router.post('/[resource]', controller.createResource);

export default router;
```

### Controller Template
```javascript
// backend/controllers/[domain].controller.js
import service from '../services/[domain].service.js';

export async function getResource(req, res) {
  try {
    const data = await service.getResource(req.params.id);
    res.json({ status: 'ok', data });
  } catch (error) {
    res.status(500).json({ 
      status: 'error', 
      error: error.message 
    });
  }
}
```

### Service Template
```javascript
// backend/services/[domain].service.js

class DomainService {
  async getResource(id) {
    // Business logic here
    // FDA Consideration: Document compliance requirements
    return data;
  }
}

export default new DomainService();
```

---

## API Response Standards

### Success Response
```json
{
  "status": "ok",
  "data": { ... },
  "messages": [],
  "timestamp": "2025-12-10T15:30:00Z"
}
```

### Error Response
```json
{
  "status": "error",
  "error": "Human-readable error message",
  "code": "ERROR_CODE",
  "timestamp": "2025-12-10T15:30:00Z"
}
```

---

## Compliance Comments

Every route that affects regulated data must include:

```javascript
/**
 * FDA 21 CFR Part 11 Consideration:
 * This endpoint [description of what it does with regulated data].
 * Requirements: [e-signature, audit trail, validation, etc.]
 */
```

---

# üß¨ MODE 4: Domain/Pharma Logic

**Trigger**: Use `@domain`, `@pharma`, `@biologics`, or when working on scientific workflows

## Domain Entities

### Batch
- batchId, productId, facilityId
- startDate, targetCompletionDate
- currentPhase, status
- kpis: viableCount, viability, titer, pH, DO
- compliance: bprGenerated, electronicSignatures, deviations

### Pipeline
- pipelineId, type (production, stability, development)
- product, operator
- stage, progress (0-100)
- risk (low, medium, high)

### Protocol
- protocolId, name, version
- steps: array of {stepId, name, duration, parameters}
- validation: IQ/OQ/PQ status
- approvedBy, approvedDate

### Instrument
- instrumentId, name, type, manufacturer, model
- status (running, idle, maintenance, error)
- connectedVia (OPC-UA, REST API, MQTT)
- lastTelemetry, currentBatch

---

## Scientific Validation Patterns

### Fermentation Parameters
```javascript
const validParams = {
  temperature: { min: 36, max: 38, unit: '¬∞C' },
  pH: { min: 6.8, max: 7.2, unit: 'pH' },
  DO: { min: 30, max: 60, unit: '%' },
  viability: { min: 85, max: 100, unit: '%' }
};
```

### Batch Release Criteria
```javascript
const releaseChecklist = {
  viableCount: value => value >= 5e6,
  viability: value => value >= 85,
  titer: value => value >= 2.0,
  sterility: value => value === 'pass',
  endotoxin: value => value < 0.5,
  bprComplete: value => value === true
};
```

---

## Workflow Templates

### Protocol Execution
```javascript
{
  protocolId: 'PROT-2025-001',
  status: 'in-progress',
  steps: [
    { stepId: 1, name: 'Media Preparation', status: 'completed' },
    { stepId: 2, name: 'Inoculation', status: 'in-progress' },
    { stepId: 3, name: 'Fermentation', status: 'pending' }
  ],
  operatorSignature: {
    operatorId: 'OP-123',
    timestamp: '2025-12-10T14:30:00Z',
    signature: 'base64EncodedSignature'
  }
}
```

---

**Last Updated**: December 10, 2025  
**Version**: 2.0 (Multi-Mode)  
**Maintained By**: NewGen Studio Technical Leadership

---

# ‚ö†Ô∏è SAFETY & COMPLIANCE ‚Äî Instrument Adapter SDK

**CRITICAL: All instrument adapter code must follow these requirements**

## 1Ô∏è‚É£ Human-in-the-Loop (HIL)

### Mandatory Operator Approval
```javascript
// ‚ùå NEVER do this in production
await adapter.sendCommand({ device: 'BR-001', command: 'START_BATCH' });

// ‚úÖ ALWAYS require operator signature
await adapter.sendCommand({
  device: 'BR-001',
  command: 'START_BATCH',
  operatorSignature: {
    operatorId: 'OP-12345',
    signature: 'base64EncodedSignature',  // Min 100 chars, RSA-PSS-SHA256
    timestamp: '2025-12-10T15:30:00Z',    // Max 60s old
    reason: 'Batch release approval per BPR-2025-001',
    signingAlgorithm: 'RSA-PSS-SHA256',
    certificatePEM: '-----BEGIN CERTIFICATE-----...'
  }
});
```

### Production Requirements
- UI/API must capture e-signature with **intent display** (show what action will be executed)
- Record **reason** (10-500 chars, contextual to action)
- Link to **Batch Production Record (BPR)** ID
- Validate signature is **‚â§60 seconds old**
- Store signature in **immutable audit trail**

### Code Pattern
```javascript
// Validation in sendCommand
if (!operatorSignature) {
  throw new Error('COMPLIANCE_ERROR: operatorSignature required for command execution');
}

if (!isSignatureValid(operatorSignature)) {
  throw new Error('COMPLIANCE_ERROR: Invalid or expired operator signature');
}
```

---

## 2Ô∏è‚É£ Audit & Provenance

### Telemetry Manifest (Required Fields)
```javascript
const telemetryManifest = {
  manifestId: 'MF-20251210-ABC123',
  manifestType: 'TELEMETRY',
  timestamp: '2025-12-10T15:30:00.000Z',  // ISO 8601
  deviceId: 'BR-2000-A',
  streamName: 'temperature',
  adapter_version: '1.0.0-alpha',
  adapter_commit: 'a7f3d9c',              // Git commit hash
  container_digest: 'sha256:abc123...',   // Docker image digest
  dataChecksum: 'sha256:xyz789...',       // SHA-256 of payload
  complianceFrameworks: ['FDA_21_CFR_Part_11', 'Health_Canada_GMP']
};
```

### Command Manifest (Additional Fields)
```javascript
const commandManifest = {
  ...telemetryManifest,
  manifestType: 'COMMAND',
  commandId: 'CMD-20251210-XYZ456',
  commandName: 'START_BATCH',
  commandHash: 'sha256:def456...',        // SHA-256 of command payload
  operatorId: 'OP-12345',
  operatorName: 'Dr. Sarah Chen',
  reason: 'Batch release approval',
  signature: 'base64Signature...',
  signatureAlgorithm: 'RSA-PSS-SHA256',
  bprId: 'BPR-2025-001',
  auditTrail: [
    { event: 'COMMAND_SUBMITTED', timestamp: '...', details: '...' },
    { event: 'SIGNATURE_VERIFIED', timestamp: '...', details: '...' },
    { event: 'COMMAND_EXECUTED', timestamp: '...', details: '...' }
  ]
};
```

### Storage Requirements
- **Immutable storage**: PostgreSQL (primary) + S3 Glacier (20-year archive)
- **Encryption**: AES-256 at rest, TLS 1.3 in transit
- **Retention**: 20 years minimum for regulated data
- **Cross-region replication**: RTO <1hr, RPO <15min

---

## 3Ô∏è‚É£ Network & Security

### mTLS Requirements
```javascript
// HTTPS agent with mutual TLS
const agent = new https.Agent({
  key: fs.readFileSync('/path/to/client-key.pem'),
  cert: fs.readFileSync('/path/to/client-cert.pem'),
  ca: fs.readFileSync('/path/to/ca-cert.pem'),
  rejectUnauthorized: true,
  minVersion: 'TLSv1.3'
});

const response = await fetch(platformUrl, { agent });
```

### Certificate Management
- **Server cert**: Trusted CA, *.newgen-studio.com, 1yr validity, RSA 4096/ECDSA P-256
- **Client cert**: NewGen internal CA, adapter-{orgId}-{instanceId}, **90-day validity**, stored in HSM
- **Certificate pinning**: SHA-256 public key hash
- **Auto-renewal**: 30 days before expiration

### Network Topology (REQUIRED)
```
Lab Network (10.0.0.0/8)
    ‚Üì
Edge Gateway (mTLS)
    ‚Üì
NewGen Platform (Cloud)
```

### Security Rules
- ‚ùå **NEVER** expose device SDKs directly to public internet
- ‚ùå **NEVER** store credentials in code or environment variables
- ‚úÖ Use **VPN** for lab network access
- ‚úÖ Use **HashiCorp Vault** or AWS Secrets Manager for credentials
- ‚úÖ Rotate credentials every **90 days**
- ‚úÖ Enable **IDS monitoring** and **SIEM logging**

---

## 4Ô∏è‚É£ Validation & Qualification

### IQ/OQ/PQ Requirements

**Installation Qualification (IQ)**: 1-2 weeks
- Hardware/software verification
- SBOM (Software Bill of Materials) verification
- Certificate installation
- Security scan (static/dynamic/dependency)
- QA-signed IQ report

**Operational Qualification (OQ)**: 2-4 weeks
- Test cases: device registration, telemetry ingestion, command execution (with/without signature)
- Manifest generation verification
- Error recovery testing
- **100% pass rate required**, <5% defect tolerance

**Performance Qualification (PQ)**: 4-8 weeks
- Metrics: telemetry latency <1s (95th percentile), command execution <5s
- Zero missing/corrupted data
- 99.5% uptime over 30 days
- 1000 events/min scalability
- **30-day validation period**

### Simulator Restrictions

**‚ùå PROHIBITED USES:**
- Production validation datasets
- Regulatory submissions
- Batch production records
- Statistical Process Control (SPC) models
- Predictive analytics training

**‚úÖ ALLOWED USES:**
- Local development
- CI/CD smoke tests
- Documentation examples
- Proof-of-concept demos

**RATIONALE:**
Simulator uses stochastic kinetics with artificial noise. Real devices have systematic biases, equipment-specific calibrations, and historical variation patterns that cannot be replicated by simulation.

---

## Compliance Code Comments Template

```javascript
/**
 * [Endpoint/Function Name]
 * 
 * FDA 21 CFR Part 11 Consideration:
 * This [function/endpoint] [description of regulated data operation].
 * 
 * Requirements:
 * - ‚úÖ Operator e-signature (RSA-PSS-SHA256, ‚â§60s validity)
 * - ‚úÖ Immutable audit trail (PostgreSQL + S3 Glacier)
 * - ‚úÖ Data integrity (SHA-256 checksums, ALCOA+ compliance)
 * - ‚úÖ Traceability (manifestId, operatorId, bprId linkage)
 * 
 * Validation Status: [IQ/OQ/PQ Required]
 * Last Review: [Date]
 */
```

---

## üéØ Quick Mode Reference

| Working On | Use Mode | Trigger |
|------------|----------|---------|
| Creating files, PRs, commits | Repo Mode | (default) |
| Designing components, styling | UI/UX Mode | `@ui` |
| Building API endpoints | Backend Mode | `@backend` |
| Biologics workflows, compliance | Domain Mode | `@domain` |
